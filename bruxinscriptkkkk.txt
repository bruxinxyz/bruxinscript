local OrionLib = loadstring(game:HttpGet(('https://raw.githubusercontent.com/shlexware/Orion/main/source')))()

local Players = game:GetService("Players")
local Camera = game:GetService("Workspace").CurrentCamera
local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()

local espEnabled = false
local espBoxes = {}

local function createESP(player)
    local espBox = Instance.new("BoxHandleAdornment")
    espBox.Name = "ESPBox_" .. player.UserId
    espBox.Size = player.Character:WaitForChild("HumanoidRootPart").Size
    espBox.Color3 = Color3.new(0, 1, 0)
    espBox.Transparency = 0.5
    espBox.AlwaysOnTop = true
    espBox.Adornee = player.Character:WaitForChild("HumanoidRootPart")

    espBox.Parent = player.Character:WaitForChild("HumanoidRootPart")
    table.insert(espBoxes, espBox)
end

local function updateESPBoxes()
    for _, espBox in pairs(espBoxes) do
        if espBox.Parent then
            espBox.Size = espBox.Adornee.Size
        else
            espBox:Destroy()
        end
    end
end

local function toggleESP(State)
    espEnabled = State
    if espEnabled then
        for _, player in pairs(Players:GetPlayers()) do
            createESP(player)
        end
    else
        for _, espBox in pairs(espBoxes) do
            espBox:Destroy()
        end
        espBoxes = {}
    end
end

local function getClosestPlayer()
    local closestPlayer = nil
    local shortestDistance = math.huge

    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer then
            local character = player.Character
            if character and character:FindFirstChild("HumanoidRootPart") then
                local rootPosition = character.HumanoidRootPart.Position
                local distance = (rootPosition - Camera.CFrame.Position).Magnitude
                if distance < shortestDistance then
                    shortestDistance = distance
                    closestPlayer = player
                end
            end
        end
    end

    return closestPlayer
end

local function toggleAimbot(State)
    aimbotEnabled = State
end

local Window = OrionLib:MakeWindow({ Name = "ESP and Aimbot", HidePremium = false, SaveConfig = true, ConfigFolder = "Orion" })

-- Player Tab --

local PlayerTab = Window:MakeTab({
    Name = "Player",
    Icon = "rbxassetid://4483345998",
    PremiumOnly = false
})

local PlayerSection = PlayerTab:AddSection({
    Name = "Player"
})

PlayerSection:AddSlider({
    Name = "Walkspeed",
    Min = 16,
    Max = 100,
    Default = 16,
    Color = Color3.fromRGB(255, 255, 255),
    Increment = 1,
    ValueName = "Walkspeed",
    Callback = function(Value)
        game.Players.LocalPlayer.Character.Humanoid.WalkSpeed = Value
    end
})

PlayerSection:AddToggle({
    Name = "ESP",
    Default = false,
    Color = Color3.fromRGB(255, 255, 255),
    Callback = toggleESP
})

-- Settings Tab --

local SettingsTab = Window:MakeTab({
    Name = "Settings",
    Icon = "rbxassetid://4483345998",
    PremiumOnly = false
})

local SettingsSection = SettingsTab:AddSection({
    Name = "Settings"
})

SettingsSection:AddButton({
    Name = "Destroy UI",
    Callback = function()
        OrionLib:Destroy()
    end
})

-- Settings End --

OrionLib:Init() -- UI Lib End

-- Additional functions for ESP Name and Aimbot --
Players.PlayerAdded:Connect(function(player)
    player.CharacterAdded:Connect(function(character)
        onCharacterAdded(character)
    end)
end)

function onCharacterAdded(character)
    character:WaitForChild("HumanoidRootPart").Changed:Connect(function()
        updateESPBoxes()
    end)
end

UserInputService.InputBegan:Connect(function(input, gameProcessedEvent)
    if not gameProcessedEvent and input.UserInputType == Enum.UserInputType.MouseButton2 and aimbotEnabled then
        local targetPlayer = getClosestPlayer()
        if targetPlayer then
            local headPosition = targetPlayer.Character.Head.Position
            local lookVector = (headPosition - Camera.CFrame.Position).Unit
            Camera.CFrame = CFrame.new(Camera.CFrame.Position, Camera.CFrame.Position + lookVector)
        end
    end
end)
